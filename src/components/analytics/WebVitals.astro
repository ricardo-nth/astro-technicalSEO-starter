---
/**
 * Web Vitals tracking component
 * Loads and initializes Core Web Vitals monitoring
 */
---

<script is:inline>
  // Import web vitals library dynamically to avoid blocking
  import('web-vitals').then(({ onFCP, onLCP, onCLS, onFID, onTTFB, onINP }) => {
    // Import our tracking utilities - using relative path that will be resolved at runtime
    import('./../../utils/vitals.js').then(({ trackWebVitals, initPerformanceMonitoring, checkPerformanceBudget }) => {
      
      // Configure analytics
      const config = {
        enabled: true,
        debug: import.meta.env.DEV, // Enable debug in development
      };

      // Track all Core Web Vitals
      onFCP((metric) => trackWebVitals(metric, config));
      onLCP((metric) => trackWebVitals(metric, config));
      onCLS((metric) => trackWebVitals(metric, config));
      onFID((metric) => trackWebVitals(metric, config));
      onTTFB((metric) => trackWebVitals(metric, config));
      
      // Track INP (Interaction to Next Paint) if available
      if (onINP) {
        onINP((metric) => trackWebVitals(metric, config));
      }

      // Initialize additional performance monitoring
      initPerformanceMonitoring();

      // Check performance budgets after page load
      window.addEventListener('load', () => {
        setTimeout(checkPerformanceBudget, 1000);
      });

      // Track page navigation performance for SPAs
      let navigationStartTime = performance.now();
      
      // Listen for Astro view transitions if available
      document.addEventListener('astro:page-load', () => {
        const navigationTime = performance.now() - navigationStartTime;
        
        import('./../../utils/vitals.js').then(({ trackCustomMetric }) => {
          trackCustomMetric('astro-navigation', navigationTime);
        });
        
        navigationStartTime = performance.now();
      });

      if (config.debug) {
        console.log('ðŸš€ Web Vitals monitoring initialized');
      }
    }).catch((error) => {
      console.warn('Failed to load vitals utilities:', error);
    });
  }).catch((error) => {
    // web-vitals library not available - fail silently
    if (import.meta.env.DEV) {
      console.warn('web-vitals library not available:', error);
    }
  });
</script>

<!-- Preconnect to analytics endpoints for better performance -->
<link rel="preconnect" href="https://www.google-analytics.com" />
<link rel="preconnect" href="https://www.googletagmanager.com" />

<!-- 
  This component should be included in the base layout
  It will automatically track Core Web Vitals and send data to analytics
-->
