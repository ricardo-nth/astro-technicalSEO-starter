---
// Import layout
import SiteLayout from '@/layouts/SiteLayout.astro';

// Import components
import Hero from '@/components/sections/Hero.astro';
import Steps from '@/components/sections/Steps.astro';
import ChooseUs from '@/components/sections/ChooseUs.astro';
import ServicesOverview from '@/components/sections/ServicesOverview.astro';
import TestimonialsOverview from '@/components/sections/TestimonialsOverview.astro';
import EnhancedSchema from '@/components/seo/EnhancedSchema.astro';

// Import page content from Content Collections
import { getEntry } from 'astro:content';
import { getServices, getFeaturedTestimonials } from '@/utils/content.ts';

// Get page content and SEO data
const pageContent = await getEntry('pages', 'index');
const seoData = await getEntry('seo', 'index');

// Get business data for homepage
const servicesData = await getServices();
const testimonials = await getFeaturedTestimonials();

// Extract data
const { hero } = pageContent?.data || {};
const {
  title,
  description,
  keywords,
  ogImage,
  robots,
  author,
  datePublished,
  dateModified,
  schema,
} = seoData?.data || {};

// Page metadata
const metadata = {
  title: title || 'Technical SEO Starter',
  description: description || 'Professional Astro template for technical SEO',
  url: new URL(Astro.url.pathname, Astro.site).toString(),
  image: ogImage ? new URL(ogImage, Astro.site).toString() : undefined,
  robots,
  author,
  keywords: keywords?.join(', '),
  ogType: 'website',
  siteName: 'Technical SEO Starter',
  twitterCard: 'summary_large_image',
};
---

<SiteLayout metadata={metadata}>
  <EnhancedSchema
    type={schema?.type || 'webpage'}
    title={title || 'Technical SEO Starter'}
    description={description || 'Professional Astro template for technical SEO'}
    url={new URL(Astro.url.pathname, Astro.site).toString()}
    image={ogImage ? new URL(ogImage, Astro.site).toString() : undefined}
    author={author ? { name: author } : undefined}
    datePublished={datePublished}
    dateModified={dateModified}
    breadcrumbs={schema?.breadcrumbs}
    faqs={schema?.faqs}
    services={schema?.services}
  />
  
  <Hero />
  <ServicesOverview services={servicesData} />
  <Steps />
  <TestimonialsOverview testimonials={testimonials} />
  <ChooseUs />
</SiteLayout>
